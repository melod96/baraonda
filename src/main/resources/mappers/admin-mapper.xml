<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Admin">
	
	<select id="selectGeneralMemberCount" resultType="java.lang.Integer">
		SELECT COUNT(*)
		FROM MEMBER
		WHERE 1 = 1
		AND ADMIN_RIGHT = 0 
		AND COMPANY_RIGHT = 0
		<if test="option1 != null and option1 != ''">
			<choose>
				<when test="option1 == 'general'">
					AND MEMBER_STATUS = 0
				</when>
				<when test="option1 == 'black'">
					AND MEMBER_STATUS = 1
				</when>
				<when test="option1 == 'secession'">
					AND MEMBER_STATUS = 2
				</when>
			</choose>
		</if>
		<if test="content != null and content != ''">
			AND (ID LIKE '%' || #{content} || '%' 
			OR NAME LIKE '%' || #{content} || '%' 
			OR NICK_NAME LIKE '%' || #{content} || '%')
		</if>
	</select>
	
	<select id="selectGeneralMemberList" resultType="map">
		SELECT MEMBER_NO, ID, NAME, NICK_NAME, PHONE, EMAIL, ENROLL_DATE, MEMBER_STATUS
		FROM MEMBER
		WHERE 1 = 1
		AND ADMIN_RIGHT = 0 
		AND COMPANY_RIGHT = 0
		<if test="option1 != null and option1 != ''">
			<choose>
				<when test="option1 == 'general'">
					AND MEMBER_STATUS = 0
				</when>
				<when test="option1 == 'black'">
					AND MEMBER_STATUS = 1
				</when>
				<when test="option1 == 'secession'">
					AND MEMBER_STATUS = 2
				</when>
			</choose>
		</if>
		<if test="content != null and content != ''">
			AND (ID LIKE '%' || #{content} || '%' 
			OR NAME LIKE '%' || #{content} || '%' 
			OR NICK_NAME LIKE '%' || #{content} || '%')
		</if>
	</select>
	
	<select id="selectCompanyMemberCount" resultType="java.lang.Integer">
		SELECT COUNT(*)
		FROM MEMBER
		WHERE 1 = 1
		AND ADMIN_RIGHT = 0 
		AND COMPANY_RIGHT = 1
		<if test="content != null and content != ''">
			AND (ID LIKE '%' || #{content} || '%' 
			OR NAME LIKE '%' || #{content} || '%' 
			OR NICK_NAME LIKE '%' || #{content} || '%')
		</if>
	</select>
	
	<select id="selectCompanyMemberList" resultType="map">
		SELECT MEMBER_NO, ID, NAME, NICK_NAME, PHONE, EMAIL, COMPANY_NAME, COMPANY_NO, BANK, ACCOUNT, CEO_NAME, ENROLL_DATE, MEMBER_STATUS
		FROM MEMBER
		WHERE 1 = 1
		AND ADMIN_RIGHT = 0 
		AND COMPANY_RIGHT = 1
		<if test="content != null and content != ''">
			AND (ID LIKE '%' || #{content} || '%' 
			OR NAME LIKE '%' || #{content} || '%' 
			OR NICK_NAME LIKE '%' || #{content} || '%')
		</if>
	</select>
	
	<select id="selectBlackMemberCount" resultType="java.lang.Integer">
		SELECT COUNT(*)
			FROM (SELECT MEMBER_NO, ID, NAME, NICK_NAME, PHONE, EMAIL, ENROLL_DATE, BLACK_DATE, LIFT_DATE, COUNT(REPORT_GET_NO) AS DECLARATIONCOUNT
				FROM (SELECT M.MEMBER_NO, M.ID, M.NAME, M.NICK_NAME, M.PHONE, M.EMAIL, M.ENROLL_DATE, B.BLACK_DATE, B.LIFT_DATE, R.REPORT_GET_NO
	      			  FROM MEMBER M
	      			  JOIN REPORT R ON(M.MEMBER_NO = R.REPORT_GET_NO)
	      			  JOIN BLACKLIST B ON(M.MEMBER_NO = B.MEMBER_NO))
			WHERE 1 = 1
	     	<if test="content != null and content != ''">
				AND (ID LIKE '%' || #{content} || '%' 
				OR NAME LIKE '%' || #{content} || '%' 
				OR NICK_NAME LIKE '%' || #{content} || '%')
			</if>
			GROUP BY MEMBER_NO, ID, NAME, NICK_NAME, PHONE, EMAIL, ENROLL_DATE, BLACK_DATE, LIFT_DATE)
	</select>
	
	<select id="selectBlackMemberList" resultType="map">
		SELECT MEMBER_NO, ID, NAME, NICK_NAME, PHONE, EMAIL, ENROLL_DATE, BLACK_DATE, LIFT_DATE, COUNT(REPORT_GET_NO) AS DECLARATIONCOUNT
			FROM (SELECT M.MEMBER_NO, M.ID, M.NAME, M.NICK_NAME, M.PHONE, M.EMAIL, M.ENROLL_DATE, B.BLACK_DATE, B.LIFT_DATE, R.REPORT_GET_NO
      			  FROM MEMBER M
      			  JOIN REPORT R ON(M.MEMBER_NO = R.REPORT_GET_NO)
      			  JOIN BLACKLIST B ON(M.MEMBER_NO = B.MEMBER_NO))
		WHERE 1 = 1
		<if test="content != null and content != ''">
			AND (ID LIKE '%' || #{content} || '%' 
			OR NAME LIKE '%' || #{content} || '%' 
			OR NICK_NAME LIKE '%' || #{content} || '%')
		</if>
		GROUP BY MEMBER_NO, ID, NAME, NICK_NAME, PHONE, EMAIL, ENROLL_DATE, BLACK_DATE, LIFT_DATE
	</select>
	
	<select id="selectNoticeCount" resultType="java.lang.Integer">
		SELECT COUNT(*)
		FROM BOARD B
		JOIN MEMBER M ON(B.MEMBER_NO = M.MEMBER_NO)
		WHERE 1 = 1
		AND BOARD_TYPE = 6
	    <if test="content != null and content != ''">
			AND (BOARD_TITLE LIKE '%' || #{content} || '%' 
			OR NICK_NAME LIKE '%' || #{content} || '%')
		</if>
	</select>
	
	<select id="selectNoticeList" resultType="map">
		SELECT B.BOARD_NO, B.BOARD_TITLE, M.NICK_NAME, B.BOARD_COUNT, B.BOARD_DATE
		FROM BOARD B
		JOIN MEMBER M ON(B.MEMBER_NO = M.MEMBER_NO)
		WHERE 1 = 1
		AND BOARD_TYPE = 6
	    <if test="content != null and content != ''">
			AND (BOARD_TITLE LIKE '%' || #{content} || '%' 
			OR NICK_NAME LIKE '%' || #{content} || '%')
		</if>
	</select>
	
	<select id="selectDeclarationCount" resultType="java.lang.Integer">
		SELECT COUNT(*)
		FROM REPORT R 
		JOIN MEMBER M1 ON(R.REPORT_GIVE_NO = M1.MEMBER_NO)
		JOIN MEMBER M2 ON(R.REPORT_GET_NO = M2.MEMBER_NO)
		WHERE 1 = 1
	    <if test="content != null and content != ''">
			AND (GIVE_NICK_NAME LIKE '%' || #{content} || '%' 
			OR GET_NICK_NAME LIKE '%' || #{content} || '%')
		</if>
	</select>
	
	<select id="selectDeclarationList" resultType="map">
		SELECT R.REPORT_NO, R.REPORT_TYPE, M1.NICK_NAME AS GIVE_NICK_NAME, M2.NICK_NAME AS GET_NICK_NAME, R.REPORT_DATE, R.REPORT_APPROVAL
		FROM REPORT R 
		JOIN MEMBER M1 ON(R.REPORT_GIVE_NO = M1.MEMBER_NO)
		JOIN MEMBER M2 ON(R.REPORT_GET_NO = M2.MEMBER_NO)
		WHERE 1 = 1
	    <if test="content != null and content != ''">
			AND (GIVE_NICK_NAME LIKE '%' || #{content} || '%' 
			OR GET_NICK_NAME LIKE '%' || #{content} || '%')
		</if>
	</select>
	
	<select id="selectOrderCount" resultType="java.lang.Integer">
		SELECT COUNT(*)
		FROM ORDERS O
		JOIN MEMBER M ON(O.MEMBER_NO = M.MEMBER_NO)
		JOIN PRODUCT P ON(O.PRODUCT_NO = P.PRODUCT_NO)
		WHERE 1 = 1 
		AND PRODUCT_TYPE = 1
	    <if test="content != null and content != ''">
			AND (NAME LIKE '%' || #{content} || '%' 
			OR PRODUCT_NAME LIKE '%' || #{content} || '%' 
			OR PHONE LIKE '%' || #{content} || '%')
		</if>
	</select>
	
	<select id="selectOrderList" resultType="map">
		SELECT O.ORDERS_NO, M.NAME, P.PRODUCT_NAME, O.PRODUCT_QUANTITY, O.ORDERS_DATE, M.PHONE
		FROM ORDERS O
		JOIN MEMBER M ON(O.MEMBER_NO = M.MEMBER_NO)
		JOIN PRODUCT P ON(O.PRODUCT_NO = P.PRODUCT_NO)
		WHERE 1 = 1 
		AND PRODUCT_TYPE = 1
	    <if test="content != null and content != ''">
			AND (NAME LIKE '%' || #{content} || '%' 
			OR PRODUCT_NAME LIKE '%' || #{content} || '%' 
			OR PHONE LIKE '%' || #{content} || '%')
		</if>
	</select>
	
	<select id="selectGeneralMemberInfo" resultType="map">
		SELECT MEMBER_NO, ID, NAME, NICK_NAME, PHONE, EMAIL, ENROLL_DATE
		FROM MEMBER 
		WHERE 1 = 1
		AND MEMBER_NO = #{num}
	</select>
	
	<select id="selectMembersDeclarationList" resultType="map">
		SELECT R.REPORT_NO, R.REPORT_TYPE, M.NICK_NAME AS GIVE_NICK_NAME, R.REPORT_DATE
		FROM REPORT R
		JOIN MEMBER M ON(M.MEMBER_NO = R.REPORT_GIVE_NO)
		WHERE 1 = 1
		AND REPORT_GET_NO = #{num}
	</select>
	
	<select id="selectMembersOrderList" resultType="map">
		SELECT O.ORDERS_NO, P.PRODUCT_NAME, O.PRODUCT_QUANTITY, O.ORDERS_DATE
		FROM ORDERS O 
		JOIN PRODUCT P ON(O.PRODUCT_NO = P.PRODUCT_NO)
		WHERE 1 = 1
		AND MEMBER_NO = #{num}
	</select>
	
	<select id="selectCompanyMemberInfo" resultType="map">
		SELECT MEMBER_NO, ID, NAME, NICK_NAME, PHONE, EMAIL, COMPANY_NAME, COMPANY_NO, BANK, ACCOUNT, CEO_NAME, CEO_TYPE, ENROLL_DATE
		FROM MEMBER 
		WHERE 1 = 1
		AND MEMBER_NO = #{num}
	</select>
	
</mapper> 
  